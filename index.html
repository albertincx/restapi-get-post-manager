<!DOCTYPE html>
<html lang="ru" id="mainHtml">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title id="pageTitle">Postman-–ø–æ–¥–æ–±–Ω—ã–π –∫–ª–∏–µ–Ω—Ç (Tailwind)</title>
    <!-- Tailwind CSS —á–µ—Ä–µ–∑ CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –∫–∞—Å—Ç–æ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Tailwind
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'tab-bg': '#f1f5f9',
                        'tab-border': '#cbd5e1',
                        'tab-active': '#e2e8f0',
                    }
                }
            }
        };
    </script>
    <style>
        /* –ú–∞–ª–µ–Ω—å–∫–∏–π —Ö–∞–∫: input –≤–Ω—É—Ç—Ä–∏ —Ç–∞–±–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω —Å–∂–∏–º–∞—Ç—å—Å—è */
        .tab-input {
            /*min-width: 50px;*/
            /*width: 100px;*/
        }

        input {
            width: 100px;
        }

        /* –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è ‚Äî –∫—Ä—É–≥–ª–∞—è */
        .close-btn {
            width: 18px;
            height: 18px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .language-selector {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 100;
        }

        /* Mobile Bottom Navigation */
        .mobile-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            background-color: #f8fafc;
            border-top: 1px solid #cbd5e1;
            z-index: 1000;
            box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.1);
        }

        .mobile-nav.show {
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .mobile-nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 25%;
            height: 100%;
            padding: 5px 0;
            border: none;
            background: none;
            cursor: pointer;
            color: #64748b;
            font-size: 12px;
        }

        .mobile-nav-btn.active {
            color: #3b82f6;
        }

        .mobile-nav-btn i {
            font-size: 20px;
            margin-bottom: 2px;
        }

        /* Hide top tabs on mobile */
        @media (max-width: 768px) {
            #tabsContainer {
                display: none;
            }

            .tab-content {
                padding-bottom: 60px; /* Space for mobile nav */
            }

            .mobile-nav {
                display: flex;
            }
        }

        /* Mobile response popup */
        .mobile-response-popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 1001;
            overflow-y: auto;
            padding: 20px;
        }

        .mobile-response-popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 15px;
            border-bottom: 1px solid #e2e8f0;
            margin-bottom: 15px;
        }

        .mobile-response-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #64748b;
        }
    </style>
</head>
<body class="bg-gray-100 h-screen flex flex-col font-sans">


<!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ç–∞–±–æ–≤ -->
<div id="tabsContainer" class="flex bg-gray-200 border-b border-gray-300 px-1 overflow-x-auto whitespace-nowrap_"></div>

<!-- Mobile Bottom Navigation -->
<div id="mobileNav" class="mobile-nav">
    <button id="mobileTabsBtn" class="mobile-nav-btn active" title="Tabs">
        <i>üìã</i>
        <span>Tabs</span>
    </button>
    <button id="mobileExecuteBtn" class="mobile-nav-btn" title="Execute">
        <i>‚ö°</i>
        <span>Execute</span>
    </button>
    <button id="mobileResponseBtn" class="mobile-nav-btn" title="Response">
        <i>üìä</i>
        <span>Response</span>
    </button>
    <button id="mobileSettingsBtn" class="mobile-nav-btn" title="Settings">
        <i>‚öôÔ∏è</i>
        <span>Settings</span>
    </button>
</div>

<!-- Mobile Response Popup -->
<div id="mobileResponsePopup" class="mobile-response-popup">
    <div class="mobile-response-popup-header">
        <h2>Response Details</h2>
        <button id="closeMobileResponsePopup" class="mobile-response-close">&times;</button>
    </div>
    <div id="mobileResponseContent"></div>
</div>

<script>
    const STORAGE_KEY = 'postman_tabs_v3';
    const METHODS = ['GET', 'POST', 'PUT', 'PATCH', 'DELETE', 'HEAD', 'OPTIONS'];
    const BODY_METHODS = ['POST', 'PUT', 'PATCH'];

    // –û–±—ä–µ–∫—Ç —Å –ø–µ—Ä–µ–≤–æ–¥–∞–º–∏
    const TRANSLATIONS = {
        ru: {
            pageTitle: "Postman-–ø–æ–¥–æ–±–Ω—ã–π –∫–ª–∏–µ–Ω—Ç (Tailwind)",
            newTabName: "–ù–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å",
            unnamed: "–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",
            urlPlaceholder: "URL",
            addHeaderBtn: "+ –î–æ–±–∞–≤–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫",
            executeRequestBtn: "–í—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å",
            requestResults: "–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–ø—Ä–æ—Å–∞",
            settingsTitle: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏",
            baseHostLabel: "–ë–∞–∑–æ–≤—ã–π URL (—Ö–æ—Å—Ç)",
            baseHostPlaceholder: "https://api.example.com",
            useBaseHostLabel: "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–π URL –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤",
            cancelBtn: "–û—Ç–º–µ–Ω–∞",
            saveBtn: "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å",
            settingsSaved: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!",
            exportBtn: "–≠–∫—Å–ø–æ—Ä—Ç",
            importBtn: "–ò–º–ø–æ—Ä—Ç",
            settingsBtn: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏",
            addTabTooltip: "–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–∞–±",
            exportTooltip: "–≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö —Ç–∞–±–æ–≤",
            importTooltip: "–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–±—ã",
            settingsTooltip: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è",
            headersLabel: "–ó–∞–≥–æ–ª–æ–≤–∫–∏ (Headers)",
            bodyLabel: "–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ (Body)",
            resultsLoading: "–ó–∞–≥—Ä—É–∑–∫–∞...",
            requestError: "–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞",
            responseHeaders: "–ó–∞–≥–æ–ª–æ–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞:",
            responseBody: "–¢–µ–ª–æ –æ—Ç–≤–µ—Ç–∞:",
            responseStatus: "–°—Ç–∞—Ç—É—Å: ",
            timestamp: "–í—Ä–µ–º—è: ",
            confirmImport: "–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∑–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ —Ç–µ–∫—É—â–∏–µ —Ç–∞–±—ã?\n–ë—É–¥–µ—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ %d —Ç–∞–±–æ–≤.%s",
            importSuccess: "–£—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ %d —Ç–∞–±–æ–≤!%s",
            importInvalidFormat: "–§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. –û–∂–∏–¥–∞–µ—Ç—Å—è –º–∞—Å—Å–∏–≤ —Ç–∞–±–æ–≤ –∏–ª–∏ –æ–±—ä–µ–∫—Ç —Å –ø–æ–ª—è–º–∏ tabs –∏ settings.",
            importError: "–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞. –í–æ–∑–º–æ–∂–Ω–æ, —Ñ–∞–π–ª –ø–æ–≤—Ä–µ–∂–¥–µ–Ω –∏–ª–∏ –∏–º–µ–µ—Ç –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç.",
            noTabsToImport: "–§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. –û–∂–∏–¥–∞–µ—Ç—Å—è –º–∞—Å—Å–∏–≤ —Ç–∞–±–æ–≤.",
            close: "–ó–∞–∫—Ä—ã—Ç—å",
            minimize: "[-]",
            maximize: "[+]",
            emptyKeyPlaceholder: "–ö–ª—é—á",
            emptyValuePlaceholder: "–ó–Ω–∞—á–µ–Ω–∏–µ",
            multipleUrlsLabel: "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ URL –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤",
            addUrlBtn: "+ –î–æ–±–∞–≤–∏—Ç—å URL",
            languageLabel: "–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞",
            multipleRequestsLabel: "–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã",
            enableMultipleRequests: "–í—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫–æ –≤—Å–µ–º URL –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ"
        },
        en: {
            pageTitle: "Postman-like client (Tailwind)",
            newTabName: "New Request",
            unnamed: "Untitled",
            urlPlaceholder: "URL",
            addHeaderBtn: "+ Add Header",
            executeRequestBtn: "Execute Request",
            requestResults: "Request Results",
            settingsTitle: "Settings",
            baseHostLabel: "Base URL (host)",
            baseHostPlaceholder: "https://api.example.com",
            useBaseHostLabel: "Use Base URL when executing requests",
            cancelBtn: "Cancel",
            saveBtn: "Save",
            settingsSaved: "Settings saved!",
            exportBtn: "Export",
            importBtn: "Import",
            settingsBtn: "Settings",
            addTabTooltip: "Add new tab",
            exportTooltip: "Export all tabs",
            importTooltip: "Import tabs",
            settingsTooltip: "Application settings",
            headersLabel: "Headers",
            bodyLabel: "Request Body",
            resultsLoading: "Loading...",
            requestError: "Request execution error",
            responseHeaders: "Response Headers:",
            responseBody: "Response Body:",
            responseStatus: "Status: ",
            timestamp: "Time: ",
            confirmImport: "Are you sure you want to replace all current tabs?\n%d tabs will be imported.%s",
            importSuccess: "Successfully imported %d tabs!%s",
            importInvalidFormat: "File contains invalid data. Expected an array of tabs or an object with tabs and settings fields.",
            importError: "Error reading file. The file may be corrupted or in an incorrect format.",
            noTabsToImport: "File contains invalid data. Expected an array of tabs.",
            close: "Close",
            minimize: "[-]",
            maximize: "[+]",
            emptyKeyPlaceholder: "Key",
            emptyValuePlaceholder: "Value",
            multipleUrlsLabel: "Additional URLs for requests",
            addUrlBtn: "+ Add URL",
            languageLabel: "Interface Language",
            multipleRequestsLabel: "Multiple Requests",
            enableMultipleRequests: "Execute requests to all URLs simultaneously"
        }
    };

    // –¢–µ–∫—É—â–∏–π —è–∑—ã–∫
    let currentLanguage = 'en'; // Default value, will be loaded from settings

    // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞
    function t(key) {
        const translation = TRANSLATIONS[currentLanguage][key];
        return translation !== undefined ? translation : key;
    }

    // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø–æ—Å–ª–µ —Å–º–µ–Ω—ã —è–∑—ã–∫–∞
    function updateLanguage() {
        // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.getElementById('pageTitle').textContent = t('pageTitle');

        // –û–±–Ω–æ–≤–ª—è–µ–º –∞—Ç—Ä–∏–±—É—Ç —è–∑—ã–∫–∞ HTML
        document.documentElement.lang = currentLanguage;

        // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ —Ç–∞–±—ã
        tabs.forEach(tab => {
            renderTabContentFresh(tab.id, true); // –û–±–Ω–æ–≤–ª—è–µ–º –±–µ–∑ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
        });

        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –≤ –≤–µ—Ä—Ö–Ω–µ–π –ø–∞–Ω–µ–ª–∏ (–µ—Å–ª–∏ –æ–Ω–∏ —É–∂–µ —Å–æ–∑–¥–∞–Ω—ã)
        const exportBtn = document.querySelector('#tabsContainer button:nth-last-child(3)');
        const importBtn = document.querySelector('#tabsContainer button:nth-last-child(2)');
        const settingsBtn = document.querySelector('#tabsContainer button:last-child');

        if (exportBtn) exportBtn.textContent = t('exportBtn');
        if (importBtn) importBtn.textContent = t('importBtn');
        if (settingsBtn) settingsBtn.textContent = t('settingsBtn');

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —è–∑—ã–∫ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
        const settings = loadSettings();
        settings.language = currentLanguage;
        saveSettings(settings);
    }

    let tabs = [];
    let currentTabId = null;
    let nextId = 1;

    // === –£—Ç–∏–ª–∏—Ç—ã ===
    const debounce = (func, wait) => {
        let timeout;
        return (...args) => {
            clearTimeout(timeout);
            timeout = setTimeout(() => func(...args), wait);
        };
    };

    // === localStorage ===
    function saveToStorage() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(tabs));
    }

    function loadFromStorage() {
        const data = localStorage.getItem(STORAGE_KEY);
        if (data) {
            try {
                tabs = JSON.parse(data);
                if (tabs.length > 0) {
                    nextId = Math.max(...tabs.map(t => t.id)) + 1;
                    tabs.forEach(tab => renderTabUI(tab));
                    activateTab(tabs[0].id);
                    renderTabContentFresh(tabs[0].id);
                    return;
                }
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ localStorage', e);
            }
        }
        createNewTab();
    }

    // === –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–∞ ===
    function createNewTab(name = t('newTabName')) {
        const newTab = {
            id: nextId++,
            name,
            url: 'https://httpbin.org/get',
            method: 'GET',
            headers: [{key: '', value: ''}],
            body: '',
            lastResult: null
        };
        tabs.push(newTab);
        // console.log('aaa', newTab)
        renderTabUI(newTab);
        activateTab(newTab.id);
        saveToStorage();
    }

    // === –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–∞ ===
    function duplicateTab(id) {
        const originalTab = tabs.find(t => t.id === id);
        if (!originalTab) return;

        const newTab = {
            id: nextId++,
            name: originalTab.name + ' (copy)',
            url: originalTab.url,
            method: originalTab.method,
            headers: JSON.parse(JSON.stringify(originalTab.headers)), // Deep copy headers
            body: originalTab.body,
            lastResult: originalTab.lastResult ? JSON.parse(JSON.stringify(originalTab.lastResult)) : null
        };
        tabs.push(newTab);
        renderTabUI(newTab);
        activateTab(newTab.id);
        saveToStorage();
    }

    // === –£–¥–∞–ª–µ–Ω–∏–µ —Ç–∞–±–∞ ===
    function removeTab(id) {
        if (tabs.length <= 1) return;
        tabs = tabs.filter(t => t.id !== id);
        document.querySelector(`.tab[data-id="${id}"]`)?.remove();
        document.querySelector(`.tab-content[data-id="${id}"]`)?.remove();

        const nextId = tabs[0]?.id;
        if (nextId !== undefined) activateTab(nextId);
        saveToStorage();
    }

    // === –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ç–∞–±–∞ ===
    function updateTabData(id, updates) {
        const tab = tabs.find(t => t.id === id);
        if (tab) {
            Object.assign(tab, updates);
            saveToStorage();
        }
    }

    // === –†–µ–Ω–¥–µ—Ä UI —Ç–∞–±–∞ (–≤–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å) ===
    function renderTabUI(tabData) {
        const tabEl = document.createElement('div');
        tabEl.className = `tab px-3 py-2 bg-white border border-gray-300 rounded-t-md mr-1 relative cursor-pointer ${currentTabId === tabData.id ? 'bg-gray-50 font-bold' : ''}`;
        tabEl.dataset.id = tabData.id;

        const input = document.createElement('input');
        input.type = 'text';
        input.value = tabData.name;
        input.className = 'tab-input bg-transparent border-none outline-none font-inherit';
        input.readOnly = true;

        input.addEventListener('dblclick', () => {
            input.readOnly = false;
            input.focus();
        });
        input.addEventListener('blur', () => {
            input.readOnly = true;
            const newName = input.value.trim() || t('unnamed');
            updateTabData(tabData.id, {name: newName});
            input.value = newName;
        });
        input.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') input.blur();
        });

        const duplicateButton = document.createElement('button');
        duplicateButton.className = 'close-btn absolute -top-1 left-0 bg-blue-100 text-blue-500 rounded-full opacity-0 group-hover:opacity-100 transition-opacity';
        duplicateButton.innerHTML = '=';
        duplicateButton.title = 'Duplicate tab';
        duplicateButton.addEventListener('click', (e) => {
            e.stopPropagation();
            duplicateTab(tabData.id);
        });

        const closeButton = document.createElement('button');
        closeButton.className = 'close-btn absolute -top-1 -right-1 bg-red-100 text-red-500 rounded-full opacity-0 group-hover:opacity-100 transition-opacity';
        closeButton.innerHTML = '√ó';
        closeButton.addEventListener('click', (e) => {
            e.stopPropagation();
            removeTab(tabData.id);
        });

        tabEl.classList.add('group');
        tabEl.appendChild(input);
        tabEl.appendChild(duplicateButton);
        tabEl.appendChild(closeButton);
        tabEl.addEventListener('click', () => activateTab(tabData.id));

        document.querySelector('#tabsContainer').appendChild(tabEl);
        renderTabContentFresh(tabData.id);
    }

    // === –ê–∫—Ç–∏–≤–∞—Ü–∏—è —Ç–∞–±–∞ ===
    function activateTab(id) {
        currentTabId = id;
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('bg-gray-50', 'font-bold'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));

        const tabEl = document.querySelector(`.tab[data-id="${id}"]`);
        const contentEl = document.querySelector(`.tab-content[data-id="${id}"]`);
        if (tabEl) tabEl.classList.add('bg-gray-50', 'font-bold');
        if (contentEl) contentEl.classList.remove('hidden');
    }

    // === –†–µ–Ω–¥–µ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Ç–∞–±–∞ ===
    function renderTabContent(tabData) {
        const content = document.createElement('div');
        content.className = 'tab-content hidden flex flex-row bg-white overflow-hidden';
        content.dataset.id = tabData.id;

        // –û—Å–Ω–æ–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å –∑–∞–ø—Ä–æ—Å–∞
        const requestPanel = document.createElement('div');
        requestPanel.className = 'flex-1 flex-col overflow-y-auto p-4';

        // –ú–µ—Ç–æ–¥ + URL
        const methodUrlGroup = document.createElement('div');
        methodUrlGroup.className = 'flex gap-2 mb-4';
        methodUrlGroup.innerHTML = `
        <select id="method-${tabData.id}" class="px-3 py-2 border border-gray-300 rounded w-24">
          ${METHODS.map(m => `<option ${m === tabData.method ? 'selected' : ''}>${m}</option>`).join('')}
        </select>
        <input type="text" id="url-${tabData.id}" value="${tabData.url}" placeholder="${t('urlPlaceholder')}" class="flex-1 px-3 py-2 border border-gray-300 rounded" />
      `;

        // –ó–∞–≥–æ–ª–æ–≤–∫–∏
        const headersGroup = document.createElement('div');
        headersGroup.className = 'mb-4';
        headersGroup.innerHTML = `<label class="block font-bold text-sm mb-2">${t('headersLabel')}</label><div id="headers-list-${tabData.id}" class="space-y-2 mb-2"></div>`;

        const headersList = headersGroup.querySelector(`#headers-list-${tabData.id}`);
        renderHeaders(headersList, tabData.headers, tabData.id);

        const addHeaderBtn = document.createElement('button');
        addHeaderBtn.className = 'px-3 py-1 bg-green-500 text-white rounded text-sm hover:bg-green-600';
        addHeaderBtn.textContent = t('addHeaderBtn');
        addHeaderBtn.addEventListener('click', () => {
            const newHeaders = [...tabData.headers, {key: '', value: ''}];
            updateTabData(tabData.id, {headers: newHeaders});
            renderTabContentFresh(tabData.id);
        });

        // –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞
        const isBodyAllowed = BODY_METHODS.includes(tabData.method);
        const bodyGroup = document.createElement('div');
        bodyGroup.className = 'mb-4';
        bodyGroup.innerHTML = `
        <label class="block font-bold text-sm mb-2">${t('bodyLabel')}</label>
        <textarea id="body-${tabData.id}" ${!isBodyAllowed ? 'disabled' : ''} class="w-full px-3 py-2 border ${isBodyAllowed ? 'border-gray-300' : 'border-gray-200 bg-gray-100'} rounded font-mono min-h-[120px]">${tabData.body}</textarea>
      `;

        // –ö–Ω–æ–ø–∫–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ URL
        const executeBtnContainer = document.createElement('div');
        executeBtnContainer.id = `execute-buttons-container-${tabData.id}`;
        executeBtnContainer.className = 'flex flex-wrap gap-2 mb-4 mt-2';

        // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞
        updateExecuteButtons(tabData.id, executeBtnContainer);

        requestPanel.appendChild(methodUrlGroup);
        requestPanel.appendChild(headersGroup);
        requestPanel.appendChild(addHeaderBtn);
        requestPanel.appendChild(bodyGroup);
        requestPanel.appendChild(executeBtnContainer);

        // –ü–∞–Ω–µ–ª—å —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ (—Å–∞–π–¥–±–∞—Ä)
        const resultsPanel = document.createElement('div');
        resultsPanel.id = `results-sidebar-${tabData.id}`;
        resultsPanel.className = 'w-1/3 border-l border-gray-300 bg-gray-50 overflow-y-auto hidden';

        // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–∞–Ω–µ–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        const resultsHeader = document.createElement('div');
        resultsHeader.className = 'p-3 bg-gray-100 border-b border-gray-300 flex justify-between items-center';
        resultsHeader.innerHTML = `
            <h3 class="font-bold">${t('requestResults')}</h3>
            <button id="toggle-results-${tabData.id}" class="text-gray-500 hover:text-gray-700">${t('minimize')}</button>
        `;

        // –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Å–∞–π–¥–±–∞—Ä–∞
        const toggleBtn = resultsHeader.querySelector(`#toggle-results-${tabData.id}`);
        toggleBtn.addEventListener('click', () => {
            resultsPanel.classList.toggle('hidden');
            toggleBtn.textContent = resultsPanel.classList.contains('hidden') ? t('maximize') : t('minimize');
        });

        // –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        const resultsContainer = document.createElement('div');
        resultsContainer.id = `results-container-${tabData.id}`;
        resultsContainer.className = 'p-4';

        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –µ—Å–ª–∏ –æ–Ω –±—ã–ª
        if (tabData.lastResult) {
            updateResultsDisplay(tabData.id, tabData.lastResult, tabData.lastResult.error ? 'error' : 'success');
        }

        resultsPanel.appendChild(resultsHeader);
        resultsPanel.appendChild(resultsContainer);

        content.appendChild(requestPanel);
        content.appendChild(resultsPanel);

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
        const methodSelect = requestPanel.querySelector(`#method-${tabData.id}`);
        const urlInput = requestPanel.querySelector(`#url-${tabData.id}`);
        const bodyTextarea = requestPanel.querySelector(`#body-${tabData.id}`);

        methodSelect.addEventListener('change', (e) => {
            updateTabData(tabData.id, {method: e.target.value});
            const allowed = BODY_METHODS.includes(e.target.value);
            bodyTextarea.disabled = !allowed;
            bodyTextarea.classList.toggle('bg-gray-100', !allowed);
            bodyTextarea.classList.toggle('border-gray-200', !allowed);
            bodyTextarea.classList.toggle('border-gray-300', allowed);
            if (!allowed) {
                bodyTextarea.value = '';
                updateTabData(tabData.id, {body: ''});
            }
        });

        urlInput.addEventListener('input', debounce((e) => {
            updateTabData(tabData.id, {url: e.target.value});
        }, 300));

        bodyTextarea.addEventListener('input', debounce((e) => {
            updateTabData(tabData.id, {body: e.target.value});
        }, 300));

        document.body.appendChild(content);
    }

    // === –†–µ–Ω–¥–µ—Ä –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ ===
    function renderHeaders(container, headers, tabId) {
        container.innerHTML = '';
        headers.forEach((header, index) => {
            const row = document.createElement('div');
            row.className = 'flex gap-2';
            row.innerHTML = `
          <input type="text" placeholder="${t('emptyKeyPlaceholder')}" value="${header.key}" class="flex-1 px-2 py-1 border border-gray-300 rounded text-sm" />
                    <input type="text" placeholder="${t('emptyValuePlaceholder')}" value="${header.value}" class="flex-1 px-2 py-1 border border-gray-300 rounded text-sm" />
          <button class="w-7 h-7 flex items-center justify-center bg-red-100 text-red-500 rounded hover:bg-red-200 text-sm">√ó</button>
        `;

            const keyInput = row.querySelector('input:first-child');
            const valueInput = row.querySelector('input:last-of-type'); // –≤—Ç–æ—Ä–æ–π input
            const removeBtn = row.querySelector('button');

            keyInput.addEventListener('input', debounce((e) => {
                headers[index].key = e.target.value;
                updateTabData(tabId, {headers: [...headers]});
            }, 300));

            valueInput.addEventListener('input', debounce((e) => {
                headers[index].value = e.target.value;
                updateTabData(tabId, {headers: [...headers]});
            }, 300));

            removeBtn.addEventListener('click', () => {
                headers.splice(index, 1);
                updateTabData(tabId, {headers: [...headers]});
                renderTabContentFresh(tabId);
            });

            container.appendChild(row);
        });
    }

    // === –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Ç–∞–±–∞ ===
    function renderTabContentFresh(tabId, updateWithoutActivate = false) {
        const oldContent = document.querySelector(`.tab-content[data-id="${tabId}"]`);
        if (oldContent) oldContent.remove();
        const tabData = tabs.find(t => t.id === tabId);
        console.log('tabData');
        console.log(tabData);
        if (tabData) {
            renderTabContent(tabData);
            if (currentTabId === tabId && !updateWithoutActivate) {
                activateTab(tabId);
            }
        }
    }

    // === –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ===
    function init() {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —è–∑—ã–∫ –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫
        const settings = loadSettings();
        currentLanguage = settings.language || 'ru';
        document.documentElement.lang = currentLanguage;

        // –ö–Ω–æ–ø–∫–∞ "+" –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–∞–±–∞
        const addButton = document.createElement('button');
        addButton.className = 'px-3 py-2 text-xl text-gray-600 hover:bg-gray-300 rounded';
        addButton.textContent = '+';
        addButton.title = t('addTabTooltip');
        addButton.addEventListener('click', () => createNewTab());
        document.querySelector('#tabsContainer').appendChild(addButton);

        // –ö–Ω–æ–ø–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞
        const exportButton = document.createElement('button');
        exportButton.className = 'px-3 py-2 ml-2 text-gray-600 hover:bg-gray-300 rounded border border-gray-300 text-sm';
        exportButton.textContent = t('exportBtn');
        exportButton.title = t('exportTooltip');
        exportButton.addEventListener('click', exportTabs);
        document.querySelector('#tabsContainer').appendChild(exportButton);

        // –ö–Ω–æ–ø–∫–∞ –∏–º–ø–æ—Ä—Ç–∞
        const importButton = document.createElement('button');
        importButton.className = 'px-3 py-2 ml-1 text-gray-600 hover:bg-gray-300 rounded border border-gray-300 text-sm';
        importButton.textContent = t('importBtn');
        importButton.title = t('importTooltip');
        importButton.addEventListener('click', importTabs);
        document.querySelector('#tabsContainer').appendChild(importButton);

        // –ö–Ω–æ–ø–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
        const settingsButton = document.createElement('button');
        settingsButton.className = 'px-3 py-2 ml-1 text-gray-600 hover:bg-gray-300 rounded border border-gray-300 text-sm';
        settingsButton.textContent = t('settingsBtn');
        settingsButton.title = t('settingsTooltip');
        settingsButton.addEventListener('click', showSettings);
        document.querySelector('#tabsContainer').appendChild(settingsButton);

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        loadFromStorage();
    }

    let showSe = false
    let showTa = false

    // === –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ ===
    function showSettings() {
        if (showSe) return;
        showSe = true
        // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
        modal.id = 'settings-modal';

        // –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        const settingsContent = document.createElement('div');
        settingsContent.className = 'bg-white p-6 rounded-lg shadow-lg w-96 max-w-full mx-4';
        settingsContent.innerHTML = `
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">${t('settingsTitle')}</h2>
                <button id="close-settings" class="text-gray-500 hover:text-gray-700">&times;</button>
            </div>
            <div class="mb-4">
                <label class="block font-bold text-sm mb-2">${t('baseHostLabel')}</label>
                <input type="text" id="base-host-input" placeholder="${t('baseHostPlaceholder')}" class="w-full px-3 py-2 border border-gray-300 rounded" />
                <p class="text-xs text-gray-500 mt-1">–ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω, –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –∫ –Ω–∞—á–∞–ª—É –≤—Å–µ—Ö URL –∑–∞–ø—Ä–æ—Å–æ–≤</p>
            </div>
            <div class="mb-4">
                <label class="flex items-center">
                    <input type="checkbox" id="use-base-host-checkbox" class="mr-2" />
                    <span class="text-sm">${t('useBaseHostLabel')}</span>
                </label>
            </div>
            <div class="mb-4">
                <label class="block font-bold text-sm mb-2">${t('multipleUrlsLabel')}</label>
                <div id="urls-container" class="space-y-2 mb-2"></div>
                <button id="add-url-btn" class="px-3 py-1 bg-green-500 text-white rounded text-sm hover:bg-green-600 mt-2">${t('addUrlBtn')}</button>
            </div>
            <div class="mb-4">
                <label class="block font-bold text-sm mb-2">${t('languageLabel')}</label>
                <select id="language-select" class="w-full px-3 py-2 border border-gray-300 rounded">
                    <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                    <option value="en">English</option>
                </select>
            </div>
            <div class="mb-4">
                <label class="flex items-center">
                    <input type="checkbox" id="enable-multiple-requests" class="mr-2" />
                    <span class="text-sm">${t('enableMultipleRequests')}</span>
                </label>
            </div>
            <div class="flex justify-end space-x-2">
                <button id="cancel-settings" class="px-4 py-2 border border-gray-300 rounded text-gray-700 hover:bg-gray-100">${t('cancelBtn')}</button>
                <button id="save-settings" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">${t('saveBtn')}</button>
            </div>
        `;

        modal.appendChild(settingsContent);
        document.body.appendChild(modal);

        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        const settings = loadSettings();
        document.getElementById('base-host-input').value = settings.baseHost || '';
        document.getElementById('use-base-host-checkbox').checked = settings.useBaseHost;

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö URL
        const urlsContainer = document.getElementById('urls-container');
        const additionalUrls = settings.additionalUrls || [];
        urlsContainer.innerHTML = '';
        additionalUrls.forEach((url, index) => {
            addUrlInput(urlsContainer, url, index);
        });

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–¥–∏–Ω –ø—É—Å—Ç–æ–π URL, –µ—Å–ª–∏ –Ω–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö URL
        if (additionalUrls.length === 0) {
            addUrlInput(urlsContainer, '', 0);
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —è–∑—ã–∫–∞
        document.getElementById('language-select').value = settings.language || 'ru';

        // –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
        document.getElementById('enable-multiple-requests').checked = settings.enableMultipleRequests || false;

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è –∫–ª–∞–≤–∏—à–∏ ESC
        function handleEscKey(event) {
            if (event.key === 'Escape') {
                closeSettingsModal();
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function closeSettingsModal() {
            // –£–¥–∞–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
            document.removeEventListener('keydown', handleEscKey);
            closeModal(modal);
            showSe = false
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
        document.getElementById('close-settings').addEventListener('click', closeSettingsModal);
        document.getElementById('cancel-settings').addEventListener('click', closeSettingsModal);

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ closeModal
        window.settingsEscHandler = handleEscKey;

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
        document.addEventListener('keydown', handleEscKey);

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—è –≤–≤–æ–¥–∞ URL
        function addUrlInput(container, value = '', index) {
            const row = document.createElement('div');
            row.className = 'flex gap-2 mb-2';
            row.innerHTML = `
                <input type="text" value="${value}" placeholder="https://api.example.com" class="flex-1 px-2 py-1 border border-gray-300 rounded text-sm" />
                <button class="w-7 h-7 flex items-center justify-center bg-red-100 text-red-500 rounded hover:bg-red-200 text-sm">√ó</button>
            `;

            const input = row.querySelector('input');
            const removeBtn = row.querySelector('button');

            removeBtn.addEventListener('click', () => {
                container.removeChild(row);
                // –ï—Å–ª–∏ –Ω–µ—Ç –Ω–∏ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—è, –¥–æ–±–∞–≤–∏–º —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –ø—É—Å—Ç–æ–µ
                if (container.children.length === 0) {
                    addUrlInput(container, '', 0);
                }
            });

            container.appendChild(row);
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è URL
        document.getElementById('add-url-btn').addEventListener('click', () => {
            const urlsContainer = document.getElementById('urls-container');
            addUrlInput(urlsContainer, '', urlsContainer.children.length);
        });

        document.getElementById('save-settings').addEventListener('click', () => {
            const baseHost = document.getElementById('base-host-input').value.trim();
            const useBaseHost = document.getElementById('use-base-host-checkbox').checked;

            // –ü–æ–ª—É—á–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ URL
            const urlsContainer = document.getElementById('urls-container');
            const urlInputs = urlsContainer.querySelectorAll('input');
            const additionalUrls = [];
            urlInputs.forEach(input => {
                if (input.value.trim()) {
                    additionalUrls.push(input.value.trim());
                }
            });

            // –ü–æ–ª—É—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —è–∑—ã–∫
            const selectedLanguage = document.getElementById('language-select').value;

            // –ü–æ–ª—É—á–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
            const enableMultipleRequests = document.getElementById('enable-multiple-requests').checked;

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            saveSettings({
                baseHost,
                useBaseHost,
                additionalUrls,
                language: selectedLanguage,
                enableMultipleRequests
            });

            // –û–±–Ω–æ–≤–ª—è–µ–º —è–∑—ã–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            if (currentLanguage !== selectedLanguage) {
                currentLanguage = selectedLanguage;
                updateLanguage();
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ –≤–æ –≤—Å–µ—Ö —Ç–∞–±–∞—Ö
            tabs.forEach(tab => {
                const container = document.getElementById(`execute-buttons-container-${tab.id}`);
                if (container) {
                    updateExecuteButtons(tab.id, container);
                }
            });

            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            closeSettingsModal();

            alert(t('settingsSaved'));
        });
    }

    // === –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ ===
    function loadSettings() {
        const settingsStr = localStorage.getItem('postman_settings');
        if (settingsStr) {
            try {
                const settings = JSON.parse(settingsStr);
                // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ —É –Ω–∞—Å –µ—Å—Ç—å –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è
                return {
                    baseHost: settings.baseHost || '',
                    useBaseHost: settings.useBaseHost || false,
                    additionalUrls: settings.additionalUrls || [],
                    language: settings.language || (localStorage.getItem('app_language') || 'ru'),
                    enableMultipleRequests: settings.enableMultipleRequests || false
                };
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫', e);
                return {
                    baseHost: '',
                    useBaseHost: false,
                    additionalUrls: [],
                    language: localStorage.getItem('app_language') || 'ru',
                    enableMultipleRequests: false
                };
            }
        }
        return {
            baseHost: '',
            useBaseHost: false,
            additionalUrls: [],
            language: localStorage.getItem('app_language') || 'ru',
            enableMultipleRequests: false
        };
    }

    // === –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ ===
    function saveSettings(settings) {
        localStorage.setItem('postman_settings', JSON.stringify(settings));
    }

    // === –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ ===
    function closeModal(ma) {
        // –£–¥–∞–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        document.removeEventListener('keydown', window.settingsEscHandler);
        document.body.removeChild(ma);
        showTa = false
        showSe = false
    }

    // === –ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ URL —Å —É—á–µ—Ç–æ–º –Ω–∞—Å—Ç—Ä–æ–µ–∫ ===
    function getFinalUrl(originalUrl) {
        const settings = loadSettings();
        // console.log(originalUrl)
        if (settings.useBaseHost && settings.baseHost) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ URL –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–º
            if (originalUrl.startsWith('/')) {
                // –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π URL - –¥–æ–±–∞–≤–ª—è–µ–º –±–∞–∑–æ–≤—ã–π —Ö–æ—Å—Ç
                return settings.baseHost + originalUrl;
            } else if (!originalUrl.startsWith('http://') && !originalUrl.startsWith('https://')) {
                // –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π URL –±–µ–∑ —Å–ª—ç—à–∞ - –¥–æ–±–∞–≤–ª—è–µ–º –±–∞–∑–æ–≤—ã–π —Ö–æ—Å—Ç
                return settings.baseHost + '/' + originalUrl;
            }
            // –ê–±—Å–æ–ª—é—Ç–Ω—ã–π URL - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
            return originalUrl;
        }

        // –ï—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π URL
        return originalUrl;
    }

    // === –≠–∫—Å–ø–æ—Ä—Ç —Ç–∞–±–æ–≤ ===
    function exportTabs() {
        // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        const settings = loadSettings();
        const exportData = {
            tabs: tabs,
            settings: settings
        };

        const dataStr = JSON.stringify(exportData, null, 2);
        const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);

        // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å—Å—ã–ª–∫–∏ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
        const exportFileDefaultName = 'postman-tabs-export.json';

        const linkElement = document.createElement('a');
        linkElement.setAttribute('href', dataUri);
        linkElement.setAttribute('download', exportFileDefaultName);
        linkElement.click(); // –°–∏–º—É–ª–∏—Ä—É–µ–º –∫–ª–∏–∫ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
    }

    // === –ò–º–ø–æ—Ä—Ç —Ç–∞–±–æ–≤ ===
    function importTabs() {
        // –°–æ–∑–¥–∞–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
        const fileInput = document.createElement('input');
        fileInput.type = 'file';
        fileInput.accept = '.json';
        fileInput.style.display = 'none';

        fileInput.onchange = function (event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const importedData = JSON.parse(e.target.result);

                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ —Ñ–∞–π–ª –∫–∞–∫ —Ç–∞–±—ã, —Ç–∞–∫ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                    let importedTabs, importedSettings;

                    if (Array.isArray(importedData)) {
                        // –°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç - —Ç–æ–ª—å–∫–æ —Ç–∞–±—ã
                        importedTabs = importedData;
                        importedSettings = null;
                    } else if (importedData.tabs) {
                        // –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç - —Ç–∞–±—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                        importedTabs = importedData.tabs;
                        importedSettings = importedData.settings || null;
                    } else {
                        // –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
                        alert(t('importInvalidFormat'));
                        return;
                    }

                    // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
                    if (!Array.isArray(importedTabs)) {
                        alert(t('noTabsToImport'));
                        return;
                    }

                    // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –∏–º–ø–æ—Ä—Ç–æ–º
                    const settingsText = importedSettings ? t('confirmImport').includes('%s') ? ' ' + t('importSuccess').split('%d')[1].split('%s')[0] : '' : '';
                    const confirmMessage = t('confirmImport')
                        .replace('%d', importedTabs.length)
                        .replace('%s', settingsText);

                    const confirmed = confirm(confirmMessage);

                    if (confirmed) {
                        // –ó–∞–º–µ–Ω—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±—ã –Ω–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ
                        tabs = importedTabs;

                        // –û–±–Ω–æ–≤–ª—è–µ–º nextId –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ ID –≤ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–∞–±–∞—Ö
                        if (tabs.length > 0) {
                            nextId = Math.max(...tabs.map(t => t.id)) + 1;
                        } else {
                            nextId = 1;
                        }

                        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
                        if (importedSettings) {
                            saveSettings(importedSettings);
                        }

                        // –û—á–∏—â–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                        document.querySelectorAll('.tab').forEach(el => el.remove());
                        document.querySelectorAll('.tab-content').forEach(el => el.remove());

                        // –†–µ–Ω–¥–µ—Ä–∏–º –Ω–æ–≤—ã–µ —Ç–∞–±—ã
                        tabs.forEach(tab => renderTabUI(tab));

                        // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–µ—Ä–≤—ã–π —Ç–∞–± –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π, –µ—Å–ª–∏ –Ω–µ—Ç —Ç–∞–±–æ–≤
                        if (tabs.length > 0) {
                            activateTab(tabs[0].id);
                            renderTabContentFresh(tabs[0].id);
                        } else {
                            createNewTab();
                        }

                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
                        saveToStorage();

                        const successMessage = t('importSuccess')
                            .replace('%d', importedTabs.length)
                            .replace('%s', settingsText ? ' ' + t('importSuccess').split('%d')[1].split('%s')[0] : '');
                        alert(successMessage);
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ:', error);
                    alert(t('importError'));
                }
            };
            reader.readAsText(file);
        };

        // –î–æ–±–∞–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –≤ –¥–æ–∫—É–º–µ–Ω—Ç –∏ –∫–ª–∏–∫–∞–µ–º –ø–æ –Ω–µ–º—É
        document.body.appendChild(fileInput);
        fileInput.click();
        document.body.removeChild(fileInput);
    }

    // === –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ HTTP –∑–∞–ø—Ä–æ—Å–∞ ===
    async function executeRequest(tabId, targetUrl = null) {
        const tabData = tabs.find(t => t.id === tabId);
        if (!tabData) return;

        // –ü–æ–ª—É—á–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        const settings = loadSettings();
        const enableMultipleRequests = settings.enableMultipleRequests || false;
        const additionalUrls = settings.additionalUrls || [];

        // –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω—ã –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∏ targetUrl –Ω–µ —É–∫–∞–∑–∞–Ω, –≤—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å—ã –∫–æ –≤—Å–µ–º URL
        if (enableMultipleRequests && !targetUrl) {
            // –°–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ –≤—Å–µ—Ö URL –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ (–æ—Å–Ω–æ–≤–Ω–æ–π + –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ)
            const allUrls = [tabData.url, ...additionalUrls].filter(url => url.trim() !== '');

            if (allUrls.length > 1) {
                // –í—ã–ø–æ–ª–Ω—è–µ–º –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫–æ –≤—Å–µ–º URL
                const results = await Promise.allSettled(
                    allUrls.map(async (url, index) => {
                        // console.log('url + tabData.url')
                        // console.log(url + tabData.url)
                        const result = await executeSingleRequest(tabId, url + tabData.url, ` (URL ${index + 1})`);
                        return {url, result};
                    })
                );

                // –§–æ—Ä–º–∏—Ä—É–µ–º –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                let combinedResult = '';
                results.forEach((result, index) => {
                    if (result.status === 'fulfilled') {
                        const url = result.value.url;
                        const requestResult = result.value.result;
                        combinedResult += `<div class="mb-4 p-3 border rounded bg-gray-50"><h4 class="font-bold">URL: ${url}</h4>`;
                        if (requestResult.error) {
                            combinedResult += `<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
                                <h3 class="font-bold">${t('requestError')}</h3>
                                <p>${requestResult.message}</p>
                                <p class="text-xs mt-1">${t('timestamp')} ${requestResult.timestamp}</p>
                            </div>`;
                        } else {
                            combinedResult += `<div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
                                <h3 class="font-bold">${t('responseStatus')}${requestResult.statusCode} ${requestResult.statusText}</h3>
                                <p class="text-xs">${t('timestamp')} ${requestResult.timestamp}</p>
                            </div>`;
                        }
                        combinedResult += '</div>';
                    } else {
                        combinedResult += `<div class="mb-4 p-3 border rounded bg-red-50"><h4 class="font-bold">URL: ${allUrls[index]}</h4>
                            <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
                                <h3 class="font-bold">${t('requestError')}</h3>
                                <p>${result.reason.message || 'Unknown error'}</p>
                            </div></div>`;
                    }
                });

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                const resultsContainer = document.getElementById(`results-container-${tabId}`);
                if (resultsContainer) {
                    resultsContainer.innerHTML = combinedResult;
                }

                return;
            }
        }

        // –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π URL –∏–ª–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –æ—Ç–∫–ª—é—á–µ–Ω—ã, –≤—ã–ø–æ–ª–Ω—è–µ–º –æ–±—ã—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å
        let urlToUse = targetUrl || tabData.url;
        // console.log('targetUrl, tabData.url')
        // console.log(targetUrl, tabData.url)
        if (urlToUse.match('http') && !tabData.url.match('http')) {
            urlToUse = targetUrl + tabData.url;
        }
        await executeSingleRequest(tabId, urlToUse);
    }

    // === –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–¥–∏–Ω–æ—á–Ω–æ–≥–æ HTTP –∑–∞–ø—Ä–æ—Å–∞ ===
    async function executeSingleRequest(tabId, targetUrl, suffix = '') {
        const tabData = tabs.find(t => t.id === tabId);
        if (!tabData) return;

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–∞–π–¥–±–∞—Ä —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏, –µ—Å–ª–∏ –æ–Ω —Å–∫—Ä—ã—Ç
        const resultsSidebar = document.getElementById(`results-sidebar-${tabId}`);
        if (resultsSidebar) {
            resultsSidebar.classList.remove('hidden');
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è –æ–¥–∏–Ω–æ—á–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞)
        if (!suffix) {
            updateResultsDisplay(tabId, `<div class="text-blue-500">${t('resultsLoading')}</div>`, 'loading');
        }

        try {
            // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
            const headers = {};
            tabData.headers.forEach(header => {
                if (header.key && header.value) {
                    headers[header.key] = header.value;
                }
            });

            // –î–æ–±–∞–≤–ª—è–µ–º Content-Type –µ—Å–ª–∏ —Ç–µ–ª–æ –µ—Å—Ç—å
            if (tabData.body && BODY_METHODS.includes(tabData.method)) {
                if (!headers['Content-Type']) {
                    headers['Content-Type'] = 'application/json';
                }
            }

            // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–ø—Ä–æ—Å–∞
            const config = {
                method: tabData.method,
                headers: headers,
            };

            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–ª–æ –µ—Å–ª–∏ –º–µ—Ç–æ–¥ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç
            if (BODY_METHODS.includes(tabData.method) && tabData.body) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–µ–ª–æ JSON —Å—Ç—Ä–æ–∫–æ–π
                try {
                    JSON.parse(tabData.body);
                    config.body = tabData.body;
                } catch (e) {
                    // –ï—Å–ª–∏ –Ω–µ JSON, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–∞–∫ —Ç–µ–∫—Å—Ç
                    config.body = tabData.body;
                }
            }

            // –ü–æ–ª—É—á–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π URL —Å —É—á–µ—Ç–æ–º –Ω–∞—Å—Ç—Ä–æ–µ–∫
            const finalUrl = getFinalUrl(targetUrl);

            // –í—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å
            const response = await fetch(finalUrl, config);
            const responseBody = await response.text();

            // –§–æ—Ä–º–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            const result = {
                statusCode: response.status,
                statusText: response.statusText,
                headers: Array.from(response.headers.entries()),
                body: responseBody,
                timestamp: new Date().toLocaleString()
            };

            // –ï—Å–ª–∏ —ç—Ç–æ –æ–¥–∏–Ω–æ—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å (–Ω–µ —á–∞—Å—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ), –æ–±–Ω–æ–≤–ª—è–µ–º –¥–∏—Å–ø–ª–µ–π
            if (!suffix) {
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                updateResultsDisplay(tabId, result, 'success');

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ç–∞–±–µ
                updateTabData(tabId, {lastResult: result});
            }

            return {url: targetUrl, result};

        } catch (error) {
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏
            const errorResult = {
                error: true,
                message: error.message,
                timestamp: new Date().toLocaleString()
            };

            // –ï—Å–ª–∏ —ç—Ç–æ –æ–¥–∏–Ω–æ—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å (–Ω–µ —á–∞—Å—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ), –æ–±–Ω–æ–≤–ª—è–µ–º –¥–∏—Å–ø–ª–µ–π
            if (!suffix) {
                updateResultsDisplay(tabId, errorResult, 'error');

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—à–∏–±–∫–∏ –≤ —Ç–∞–±–µ
                updateTabData(tabId, {lastResult: errorResult});
            }

            return {url: targetUrl, result: errorResult};
        }
    }

    // === –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ ===
    function updateExecuteButtons(tabId, container) {
        const tabData = tabs.find(t => t.id === tabId);
        if (!tabData) return;

        // –ü–æ–ª—É—á–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö URL
        const settings = loadSettings();
        const additionalUrls = settings.additionalUrls || [];

        // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
        container.innerHTML = '';

        // –°–æ–∑–¥–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –∫–Ω–æ–ø–∫—É –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ URL
        const mainExecuteBtn = document.createElement('button');
        mainExecuteBtn.className = 'px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600';
        mainExecuteBtn.textContent = t('executeRequestBtn');
        mainExecuteBtn.title = tabData.url; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º URL –≤ –ø–æ–¥—Å–∫–∞–∑–∫–µ
        mainExecuteBtn.addEventListener('click', () => {
            executeRequest(tabId, tabData.url);
        });
        container.appendChild(mainExecuteBtn);

        // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö URL
        additionalUrls.forEach((url, index) => {
            const additionalExecuteBtn = document.createElement('button');
            additionalExecuteBtn.className = 'px-4 py-2 bg-indigo-500 text-white rounded hover:bg-indigo-600';
            additionalExecuteBtn.textContent = `URL ${url}`;
            additionalExecuteBtn.title = url; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º URL –≤ –ø–æ–¥—Å–∫–∞–∑–∫–µ
            additionalExecuteBtn.addEventListener('click', () => {
                executeRequest(tabId, url);
            });
            container.appendChild(additionalExecuteBtn);
        });
    }

    // === –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ ===
    function updateResultsDisplay(tabId, result, status) {
        const resultsContainer = document.getElementById(`results-container-${tabId}`);
        if (!resultsContainer) return;

        let displayContent = '';

        if (status === 'loading') {
            displayContent = `<div class="text-blue-500">${t('resultsLoading')}</div>`; // Use loading text from translations
        } else if (result.error) {
            displayContent = `
                <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
                    <h3 class="font-bold">${t('requestError')}</h3>
                    <p>${result.message}</p>
                    <p class="text-xs mt-1">${t('timestamp')} ${result.timestamp}</p>
                </div>
            `;
        } else {
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —É—Å–ø–µ—à–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            displayContent = `
                <div class="mb-4">
                    <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
                        <h3 class="font-bold">${t('responseStatus')}${result.statusCode} ${result.statusText}</h3>
                        <p class="text-xs">${t('timestamp')} ${result.timestamp}</p>
                    </div>

                    <h4 class="font-bold mb-2">${t('responseHeaders')}</h4>
                    <div class="overflow-x-auto max-h-40 overflow-y-auto mb-4 border rounded">
                        <table class="min-w-full divide-y divide-gray-200 text-sm">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-3 py-2 text-left">${t('emptyKeyPlaceholder')}</th>
                                    <th class="px-3 py-2 text-left">${t('emptyValuePlaceholder')}</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                ${result.headers.map(([name, value]) => `
                                    <tr>
                                        <td class="px-3 py-1 font-medium">${name}</td>
                                        <td class="px-3 py-1">${value}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>

                    <h4 class="font-bold mb-2">${t('responseBody')}</h4>
                    <pre class="bg-gray-100 p-4 rounded border max-h-96 overflow-y-auto whitespace-pre-wrap font-mono text-sm">${formatResponseBody(result.body)}</pre>
                </div>
            `;
        }

        resultsContainer.innerHTML = displayContent;
    }

    // === –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–∞ –æ—Ç–≤–µ—Ç–∞ ===
    function formatResponseBody(body) {
        try {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–µ–ª–æ JSON
            const parsed = JSON.parse(body);
            return JSON.stringify(parsed, null, 2);
        } catch (e) {
            // –ï—Å–ª–∏ –Ω–µ JSON, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
            return body;
        }
    }

    // === –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ===
    function init() {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —è–∑—ã–∫ –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫
        const settings = loadSettings();
        currentLanguage = settings.language || 'ru';
        document.documentElement.lang = currentLanguage;

        // –ö–Ω–æ–ø–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞
        const exportButton = document.createElement('button');
        exportButton.className = 'px-3 py-2 ml-2 text-gray-600 hover:bg-gray-300 rounded border border-gray-300 text-sm';
        exportButton.textContent = t('exportBtn');
        exportButton.title = t('exportTooltip');
        exportButton.addEventListener('click', exportTabs);
        document.querySelector('#tabsContainer').appendChild(exportButton);

        // –ö–Ω–æ–ø–∫–∞ –∏–º–ø–æ—Ä—Ç–∞
        const importButton = document.createElement('button');
        importButton.className = 'px-3 py-2 ml-1 text-gray-600 hover:bg-gray-300 rounded border border-gray-300 text-sm';
        importButton.textContent = t('importBtn');
        importButton.title = t('importTooltip');
        importButton.addEventListener('click', importTabs);
        document.querySelector('#tabsContainer').appendChild(importButton);

        // –ö–Ω–æ–ø–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
        const settingsButton = document.createElement('button');
        settingsButton.className = 'px-3 py-2 ml-1 text-gray-600 hover:bg-gray-300 rounded border border-gray-300 text-sm';
        settingsButton.textContent = t('settingsBtn');
        settingsButton.title = t('settingsTooltip');
        settingsButton.addEventListener('click', showSettings);
        document.querySelector('#tabsContainer').appendChild(settingsButton);
        // –ö–Ω–æ–ø–∫–∞ "+" –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–∞–±–∞
        const addButton = document.createElement('button');
        addButton.className = 'px-3 py-2 text-xl text-gray-600 hover:bg-gray-300 rounded';
        addButton.textContent = '+';
        addButton.title = t('addTabTooltip');
        addButton.addEventListener('click', () => createNewTab());
        document.querySelector('#tabsContainer').appendChild(addButton);

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        loadFromStorage();

        // Setup mobile navigation
        setupMobileNavigation();
    }

    // –ó–∞–ø—É—Å–∫
    init();

    // Mobile Navigation Functions
    function setupMobileNavigation() {
        const mobileTabsBtn = document.getElementById('mobileTabsBtn');
        const mobileExecuteBtn = document.getElementById('mobileExecuteBtn');
        const mobileResponseBtn = document.getElementById('mobileResponseBtn');
        const mobileSettingsBtn = document.getElementById('mobileSettingsBtn');
        const mobileResponsePopup = document.getElementById('mobileResponsePopup');
        const closeMobileResponsePopup = document.getElementById('closeMobileResponsePopup');
        const mobileResponseContent = document.getElementById('mobileResponseContent');

        // Tabs button - switch between tabs
        mobileTabsBtn.addEventListener('click', () => {
            // Highlight active button
            document.querySelectorAll('.mobile-nav-btn').forEach(btn => btn.classList.remove('active'));
            mobileTabsBtn.classList.add('active');

            // Show tabs container (for mobile we might want to show a tab selector)
            showTabSelector();
        });

        // Execute button - execute the current request
        mobileExecuteBtn.addEventListener('click', () => {
            // Highlight active button
            document.querySelectorAll('.mobile-nav-btn').forEach(btn => btn.classList.remove('active'));
            mobileExecuteBtn.classList.add('active');

            // Execute request for current tab
            if (currentTabId) {
                const tabData = tabs.find(t => t.id === currentTabId);
                if (tabData) {
                    executeRequest(currentTabId, tabData.url);
                }
            }
        });

        // Response button - show response in popup
        mobileResponseBtn.addEventListener('click', () => {
            // Highlight active button
            document.querySelectorAll('.mobile-nav-btn').forEach(btn => btn.classList.remove('active'));
            mobileResponseBtn.classList.add('active');

            // Show response popup
            if (currentTabId) {
                const tabData = tabs.find(t => t.id === currentTabId);
                if (tabData && tabData.lastResult) {
                    mobileResponseContent.innerHTML = formatMobileResponse(tabData.lastResult);
                    mobileResponsePopup.style.display = 'block';
                } else {
                    mobileResponseContent.innerHTML = '<p>No response available. Execute a request first.</p>';
                    mobileResponsePopup.style.display = 'block';
                }
            }
        });

        // Settings button - show settings
        mobileSettingsBtn.addEventListener('click', () => {
            // Highlight active button
            document.querySelectorAll('.mobile-nav-btn').forEach(btn => btn.classList.remove('active'));
            mobileSettingsBtn.classList.add('active');

            // Show settings modal
            showSettings();
        });

        // Close response popup
        closeMobileResponsePopup.addEventListener('click', () => {
            mobileResponsePopup.style.display = 'none';
        });

        // Also close popup when clicking outside of it
        mobileResponsePopup.addEventListener('click', (e) => {
            if (e.target === mobileResponsePopup) {
                mobileResponsePopup.style.display = 'none';
            }
        });

        // Initialize active state for mobile nav buttons
        document.querySelectorAll('.mobile-nav-btn').forEach(btn => btn.classList.remove('active'));
        mobileTabsBtn.classList.add('active');
    }

    // Function to show tab selector on mobile
    function showTabSelector() {
        if (showTa) return;
        showTa = true
        // This could be a dropdown or modal with available tabs
        const tabNames = tabs.map(tab => tab.name);

        // Create a simple modal to select tabs
        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
        modal.innerHTML = `
            <div class="bg-white p-6 rounded-lg shadow-lg w-80 max-w-full mx-4">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold">Select Tab</h2>
                    <button id="close-tab-selector" class="text-gray-500 hover:text-gray-700">&times;</button>
                </div>
                <div id="tab-list" class="space-y-2 max-h-96 overflow-y-auto">
                    ${tabs.map(tab => `
                        <div class="p-2 border border-gray-200 rounded hover:bg-gray-100 cursor-pointer tab-option" data-id="${tab.id}">
                            ${tab.name}
                        </div>
                    `).join('')}
                </div>
                <div class="mt-4 flex justify-end">
                    <button id="add-new-tab-mobile" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">+ New Tab</button>
                </div>
            </div>
        `;

        document.body.appendChild(modal);

        // function closeModal() {
        //     document.body.removeChild(modal);
        //     showTa = false
        //     showSe = false
        // }

        // Add event listeners to tab options
        document.querySelectorAll('.tab-option').forEach(option => {
            option.addEventListener('click', () => {
                const tabId = parseInt(option.getAttribute('data-id'));
                activateTab(tabId);

                // Update mobile nav active state
                document.querySelectorAll('.mobile-nav-btn').forEach(btn => btn.classList.remove('active'));
                document.getElementById('mobileTabsBtn').classList.add('active');

                closeModal(modal)
            });
        });

        // Close button
        document.getElementById('close-tab-selector').addEventListener('click', () => {
            closeModal(modal)
        });

        // Add new tab button
        document.getElementById('add-new-tab-mobile').addEventListener('click', () => {
            createNewTab();
            closeModal(modal)
        });

        // Click outside to close
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                closeModal(modal)
            }
        });
    }

    // Function to format response for mobile popup
    function formatMobileResponse(result) {
        if (result.error) {
            return `
                <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
                    <h3 class="font-bold">${t('requestError')}</h3>
                    <p>${result.message}</p>
                    <p class="text-xs mt-1">${t('timestamp')} ${result.timestamp}</p>
                </div>
            `;
        } else {
            return `
                <div class="mb-4">
                    <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
                        <h3 class="font-bold">${t('responseStatus')}${result.statusCode} ${result.statusText}</h3>
                        <p class="text-xs">${t('timestamp')} ${result.timestamp}</p>
                    </div>

                    <h4 class="font-bold mb-2">${t('responseHeaders')}</h4>
                    <div class="overflow-x-auto max-h-40 overflow-y-auto mb-4 border rounded">
                        <table class="min-w-full divide-y divide-gray-200 text-sm">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-3 py-2 text-left">${t('emptyKeyPlaceholder')}</th>
                                    <th class="px-3 py-2 text-left">${t('emptyValuePlaceholder')}</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                ${result.headers.map(([name, value]) => `
                                    <tr>
                                        <td class="px-3 py-1 font-medium">${name}</td>
                                        <td class="px-3 py-1">${value}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>

                    <h4 class="font-bold mb-2">${t('responseBody')}</h4>
                    <pre class="bg-gray-100 p-4 rounded border max-h-96 overflow-y-auto whitespace-pre-wrap font-mono text-sm">${formatResponseBody(result.body)}</pre>
                </div>
            `;
        }
    }

</script>
</body>
</html>
